import { q } from './selector'
import type { RefValue } from './types'

export function domRefs(ref: RefValue, scope: HTMLElement) {
  const parent = scope

  const nodeReducer = (nodes: HTMLElement[]) => {
    switch (nodes.length) {
      case 1:
        return nodes[0]
      case 0:
        throw new Error('element is not exists')
      default:
        return nodes
    }
  }

  const $ = (query: string) => {
    const nodes = q(`[data-ref="${query}"]`, parent)
    return nodeReducer(nodes)
  }

  const childRef = [...ref].map(refKey => $(refKey))
  return childRef
}
