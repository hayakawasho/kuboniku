const rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/

/**
 * Parse value to data type.
 *
 * @link   https://github.com/jquery/jquery/blob/3.1.1/src/data.js
 * @param  {string} data - A value to convert.
 * @return {mixed}  Returns the value in its natural data type.
 */

function parseVal(value: any) {
  if (value === 'true') {
    return true
  }

  if (value === 'false') {
    return false
  }

  if (value === 'null') {
    return null
  }

  // Only convert to a number if it doesn't change the string
  if (value === +value + '') {
    return +value
  }

  if (rbrace.test(value)) {
    return JSON.parse(value)
  }

  return value
}

/**
 * Get element data attributes
 * @param   {DOMElement}  node
 * @return  {Array} data
 */
export function getNodeDataType(node: HTMLElement) {
  const data: { [key: string]: string } = {}
  const attrs = node.dataset

  for (const i in attrs) {
    data[i] = parseVal(attrs[i])
  }

  return data
}
