---
import WorkDetail from "../_components/page/work-single/view";
import { createWorkRepository } from "./../_repositories";
import DefalutLayout from "./../layout.astro";

const { searchParams } = Astro.url

const id = searchParams.get('id')
const nonce = searchParams.get('nonce')

const reqHeaders = {
  "Content-Type": "application/json",
  ...(nonce && { "X-WP-Nonce": nonce })
}
const workRepo = createWorkRepository(reqHeaders)
const result = await workRepo.findById({
  id: id as string,
  asPreview: true,
})

if (!result) {
  return new Response(null, {
    status: 404,
    statusText: "Not found"
  });
}

export const prerender = false;
---

<DefalutLayout title={result.work.title} permalink={``} namespace="work-single">
  <WorkDetail post={result.work} nextPost={result.work.next} projectNumber={result.work.index} namespace="work-single" />
</DefalutLayout>
