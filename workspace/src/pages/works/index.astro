---
import WorksIndex from '../../_components/page.works/index.view';
import { mq } from '../../_foundation/mq';
import { cloudinaryAPIConverter } from '../../_foundation/converter';
import { createWorksRepository } from '../../_repositories/works/index';
import Layout from '../../layout.astro';

const repo = createWorksRepository();
const result = await repo.findMany({
  order: "desc",
  per_page: 99,
});

---

<Layout title="Works" permalink='/works/' namespace='works'>
  <link
    slot="prependHead"
    as="image"
    crossorigin="anonymous"
    href={cloudinaryAPIConverter(result.works[0].thumb["sp"].url, "f_auto,q_auto,w_1680")}
    media={mq.sp}
    rel="preload"
  />
  <link
    slot="prependHead"
    as="image"
    crossorigin="anonymous"
    href={cloudinaryAPIConverter(result.works[1].thumb["pc"].url, "f_auto,q_auto,w_1680")}
    media={mq.pc}
    rel="preload"
  />
  <WorksIndex posts={result.works} total={Number(result.totalCount)} namespace='works' />
</Layout>
